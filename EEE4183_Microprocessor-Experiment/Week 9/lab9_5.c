#include <stm32f10x.h>

u8 font8x8[16][8] = {
  {0x3C, 0x42, 0x62, 0x58, 0x4A, 0x46, 0x3C, 0x00}, //0
  {0x08, 0x0C, 0x0A, 0x08, 0x08, 0x08, 0x3E, 0x00}, //1
  {0x3C, 0x42, 0x40, 0x30, 0x0C, 0x42, 0x7E, 0x00}, //2
  {0x3C, 0x42, 0x40, 0x38, 0x40, 0x42, 0x3C, 0x00}, //3
  {0x10, 0x18, 0x24, 0x12, 0xCF, 0x10, 0x38, 0x00}, //4
  {0x7E, 0x02, 0x3E, 0x40, 0x40, 0x42, 0x3C, 0x00}, //5
  {0x38, 0x04, 0x02, 0x3E, 0x42, 0x42, 0x3c, 0x00}, //6
  {0x7E, 0x42, 0x20, 0x10, 0x08, 0x08, 0x08, 0x00}, //7
  {0x3c, 0x42, 0x42, 0x3c, 0x42, 0x42, 0x3c, 0x00}, //8
  {0x3c, 0x42, 0x42, 0x7C, 0x40, 0x20, 0x1C, 0x00}, //9
  {0x18, 0x24, 0x42, 0x42, 0x7e, 0x42, 0x42, 0x00}, //A
  {0x7C, 0x22, 0x22, 0x3c, 0x22, 0x22, 0x7C, 0x00}, //B
  {0x38, 0x44, 0x02, 0x02, 0x02, 0x44, 0x38, 0x00}, //C
  {0x1E, 0x24, 0x44, 0x44, 0x44, 0x24, 0x1E, 0x00}, //D
  {0x7e, 0x44, 0x14, 0x1C, 0x14, 0x44, 0x7e, 0x00}, //E
  {0x7e, 0x44, 0x14, 0x1C, 0x14, 0x04, 0x0E, 0x00}, //F
};
u8 data = 0xA;
u32 row, col, i;

	int main(void) {
  
  RCC->APB2ENR = 0x0000081D;
  GPIOC->CRL = 0x33333333;
  GPIOB->CRH = 0x33333333;

  TIM1->CR1 = 0x00;
  TIM1->CR2 = 0x00;
  TIM1->PSC = 0xF;
  TIM1->ARR = 0xF;

  TIM1->DIER = 0x0001;
  NVIC->ISER[0] = 0x02000000;
  TIM1->CR1 |= 0x0001;

  row = 1;
  col = 0;
  i = 0;

  while(1){ ;}
} //end main

void TIM1_UP_IRQHandler(void) {
  if((TIM1->SR & 0x0001) != 0) {
    GPIOC->ODR = ~row;
    row = row << 1;
    col = font8x8[data][i];
    GPIOB->ODR = col << 8;
    i++;
    if(row == 0x100) {row = 1; i = 0;}
    TIM1->SR &= ~(1 << 0); //clear UIF
  }
}